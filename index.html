<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keep or Toss - ÌôîÏû•Ìíà Ïú†ÌÜµÍ∏∞Ìïú Í¥ÄÎ¶¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }

    header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .main-content {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    /* Add Product Section */
    .image-upload {
      margin-bottom: 20px;
    }

    .choose-image-btn {
      width: 100%;
      padding: 12px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background 0.3s;
    }

    .choose-image-btn:hover {
      background: #5568d3;
    }

    .image-preview {
      margin-top: 15px;
      border: 2px dashed #ddd;
      border-radius: 8px;
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #f8f9fa;
    }

    .image-preview img {
      max-width: 100%;
      max-height: 300px;
      object-fit: contain;
    }

    .image-preview span {
      color: #999;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-weight: 500;
    }

    .form-group input {
      width: 100%;
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #667eea;
    }

    .pao-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .pao-option {
      padding: 12px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s;
    }

    .pao-option:hover {
      border-color: #667eea;
      background: #f0f3ff;
    }

    .pao-option.active {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .btn {
      padding: 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s;
      font-weight: 500;
    }

    .btn-primary {
      background: #28a745;
      color: white;
    }

    .btn-primary:hover {
      background: #218838;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    /* Messages */
    .message {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 15px;
      display: none;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .info-message {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    /* Loading Indicator */
    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    .loading-spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Shelf Section */
    .shelf-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .shelf-section {
      margin-bottom: 30px;
    }

    .shelf-section h3 {
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      color: white;
      font-size: 1.2rem;
    }

    .shelf-section.expired h3 {
      background: #dc3545;
    }

    .shelf-section.warning h3 {
      background: #ffc107;
      color: #333;
    }

    .shelf-section.safe h3 {
      background: #28a745;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }

    .product-card {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }

    .product-card:hover {
      transform: translateY(-5px);
    }

    .product-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .product-info {
      padding: 15px;
    }

    .product-info h4 {
      margin-bottom: 8px;
      color: #333;
      font-size: 1rem;
    }

    .product-info p {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 5px;
    }

    .status-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
      font-weight: bold;
      margin-top: 5px;
    }

    .status-badge.expired {
      background: #dc3545;
      color: white;
    }

    .status-badge.warning {
      background: #ffc107;
      color: #333;
    }

    .status-badge.safe {
      background: #28a745;
      color: white;
    }

    .delete-btn {
      width: 100%;
      padding: 8px;
      background: #dc3545;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.3s;
    }

    .delete-btn:hover {
      background: #c82333;
    }

    .empty-shelf {
      text-align: center;
      color: #999;
      padding: 40px;
      font-size: 1.1rem;
    }

    /* Reset All Button */
    .reset-all {
      text-align: center;
      margin-top: 20px;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
      padding: 12px 30px;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
      }

      .pao-buttons {
        grid-template-columns: repeat(2, 1fr);
      }

      .product-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
    }

    input[type="file"] {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üß¥ Keep or Toss</h1>
      <p>ÌôîÏû•Ìíà Í∞úÎ¥â ÌõÑ ÏÇ¨Ïö©Í∏∞Ìïú(PAO) Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú</p>
    </header>

    <div class="main-content">
      <!-- Add Product Section -->
      <div class="card">
        <h2>Add Product</h2>
        
        <div class="message error-message" id="errorMessage"></div>
        <div class="message info-message" id="infoMessage"></div>

        <div class="image-upload">
          <button class="choose-image-btn" id="chooseImageBtn">üì∑ Choose Image</button>
          <input type="file" id="imageInput" accept="image/*">
          <div class="image-preview" id="imagePreview">
            <span>Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞</span>
          </div>
        </div>

        <div class="form-group">
          <label for="productName">Product Name (Optional)</label>
          <input type="text" id="productName" placeholder="e.g. ÏóêÏä§ÎçîÏùò ÏÑ∏Îüº">
        </div>

        <div class="form-group">
          <label for="openedDate">Opened Date</label>
          <input type="date" id="openedDate">
        </div>

        <div class="form-group">
          <label>Period After Opening (PAO)</label>
          <div class="pao-buttons" id="paoButtons">
            <!-- PAO buttons will be inserted here dynamically -->
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn btn-primary" id="addToShelfBtn">Add to Shelf</button>
          <button class="btn btn-secondary" id="clearBtn">Clear</button>
        </div>
      </div>

      <!-- My Shelf Section -->
      <div class="card">
        <div class="shelf-header">
          <h2>üè∑Ô∏è My Shelf</h2>
          <button class="btn btn-secondary" id="clearShelfBtn">Clear Shelf</button>
        </div>
        <div id="shelfContainer"></div>
      </div>
    </div>

    <!-- Reset All Button -->
    <div class="reset-all">
      <button class="btn btn-danger" id="resetAllBtn">‚ö†Ô∏è Reset All</button>
    </div>
  </div>

  <!-- Loading Indicator -->
  <div class="loading" id="loadingIndicator">
    <div class="loading-spinner"></div>
  </div>

  <script>
    // Configuration
    const WORKER_URL = 'https://pao-ocr-worker.ohryee.workers.dev/ocr';

    // DOM Elements
    const imageInput = document.getElementById('imageInput');
    const chooseImageBtn = document.getElementById('chooseImageBtn');
    const imagePreview = document.getElementById('imagePreview');
    const productNameInput = document.getElementById('productName');
    const openedDateInput = document.getElementById('openedDate');
    const paoButtonsContainer = document.getElementById('paoButtons');
    const addToShelfBtn = document.getElementById('addToShelfBtn');
    const clearBtn = document.getElementById('clearBtn');
    const shelfContainer = document.getElementById('shelfContainer');
    const clearShelfBtn = document.getElementById('clearShelfBtn');
    const resetAllBtn = document.getElementById('resetAllBtn');
    const errorMessage = document.getElementById('errorMessage');
    const infoMessage = document.getElementById('infoMessage');
    const loadingIndicator = document.getElementById('loadingIndicator');

    // State
    let selectedPAO = null;
    let uploadedImage = null;
    let products = [];

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      renderShelf();
      setDefaultDate();
      
      // Event Listeners
      chooseImageBtn.addEventListener('click', () => imageInput.click());
      imageInput.addEventListener('change', handleImageUpload);
      addToShelfBtn.addEventListener('click', addProduct);
      clearBtn.addEventListener('click', clearForm);
      clearShelfBtn.addEventListener('click', clearShelf);
      resetAllBtn.addEventListener('click', resetAll);
    });

    // Set default date to today
    function setDefaultDate() {
      const today = new Date().toISOString().split('T')[0];
      openedDateInput.value = today;
    }

    // Handle image upload
    async function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      // Validate file type
      if (!file.type.startsWith('image/')) {
        showError('Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.');
        return;
      }

      // Validate file size (max 5MB)
      if (file.size > 5 * 1024 * 1024) {
        showError('Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞Îäî 5MB Ïù¥ÌïòÏó¨Ïïº Ìï©ÎãàÎã§.');
        return;
      }

      uploadedImage = file;
      
      // Show preview
      const reader = new FileReader();
      reader.onload = (e) => {
        imagePreview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
      };
      reader.readAsDataURL(file);

      // Analyze image
      await analyzeImage(file);
    }

    // Analyze image with OCR
    async function analyzeImage(file) {
      showLoading(true);
      
      try {
        // 1. ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄÎ°ú ÏãúÎèÑ
        console.log('Attempting OCR with original image...');
        let result = await tryOCR(file);
        console.log('First attempt result:', result);
        
        // 2. Ïã§Ìå® Ïãú Ïù¥ÎØ∏ÏßÄ Ï†ÑÏ≤òÎ¶¨ ÌõÑ Ïû¨ÏãúÎèÑ
        if (!result.success || result.pao.length === 0) {
          console.log('First attempt failed, trying with enhanced image...');
          showInfo('Ïù¥ÎØ∏ÏßÄÎ•º Í∞úÏÑ†ÌïòÏó¨ Ïû¨ÏãúÎèÑ Ï§ë...');
          
          const enhancedFile = await enhanceImage(file);
          result = await tryOCR(enhancedFile);
          console.log('Second attempt result:', result);
        }
        
        if (result.success && result.pao.length > 0) {
          displayPAOOptions(result.pao, result.text);
          hideMessages();
        } else {
          showError('PAOÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
          showInfo(`Í∞êÏßÄÎêú ÌÖçÏä§Ìä∏: ${result.text || 'ÏóÜÏùå'}`);
          console.log('All detected texts:', result.allTexts);
        }
        
      } catch (error) {
        console.error('OCR Error:', error);
        showError('Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
      } finally {
        showLoading(false);
      }
    }

    // Try OCR request
    async function tryOCR(file) {
      const base64 = await fileToBase64(file);
      const imageData = base64.split(',')[1];
      
      const response = await fetch(`${WORKER_URL}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ image: imageData })
      });
      
      if (!response.ok) {
        throw new Error(`OCR request failed: ${response.status}`);
      }
      
      return await response.json();
    }

    // Enhance image quality
    async function enhanceImage(file) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        img.onload = () => {
          try {
            // Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞ ÌôïÎåÄ (Ìï¥ÏÉÅÎèÑ Ìñ•ÏÉÅ)
            const scale = 2;
            canvas.width = img.width * scale;
            canvas.height = img.height * scale;
            
            // Í≥†ÌíàÏßà Ïä§ÏºÄÏùºÎßÅ
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            
            // ÎåÄÎπÑ Ï¶ùÍ∞Ä
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            const contrast = 30;
            const factor = (259 * (contrast + 255)) / (255 * (259 - contrast));
            
            for (let i = 0; i < data.length; i += 4) {
              data[i] = Math.min(255, Math.max(0, factor * (data[i] - 128) + 128));     // R
              data[i+1] = Math.min(255, Math.max(0, factor * (data[i+1] - 128) + 128)); // G
              data[i+2] = Math.min(255, Math.max(0, factor * (data[i+2] - 128) + 128)); // B
            }
            
            ctx.putImageData(imageData, 0, 0);
            
            // CanvasÎ•º BlobÏúºÎ°ú Î≥ÄÌôò
            canvas.toBlob((blob) => {
              if (blob) {
                const enhancedFile = new File([blob], file.name, { type: 'image/jpeg' });
                resolve(enhancedFile);
              } else {
                reject(new Error('Failed to create enhanced image'));
              }
            }, 'image/jpeg', 0.95);
          } catch (error) {
            reject(error);
          }
        };
        
        img.onerror = () => {
          reject(new Error('Failed to load image'));
        };
        
        img.src = URL.createObjectURL(file);
      });
    }

    // Convert file to base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Display PAO options
    function displayPAOOptions(paoValues, detectedText) {
      paoButtonsContainer.innerHTML = '';
      selectedPAO = null;

      // Show detected text info
      if (detectedText) {
        showInfo(`üìù PAO Ïù∏Ïãù ÏÑ±Í≥µ! Í∞êÏßÄÎêú ÌÖçÏä§Ìä∏: "${detectedText}"`);
      }

      // Create buttons for each detected PAO
      paoValues.forEach(pao => {
        const button = document.createElement('button');
        button.textContent = `${pao}M`;
        button.classList.add('pao-option');
        button.addEventListener('click', () => selectPAO(pao, button));
        paoButtonsContainer.appendChild(button);
      });

      // Auto-select if only one option
      if (paoValues.length === 1) {
        const button = paoButtonsContainer.querySelector('.pao-option');
        selectPAO(paoValues[0], button);
      }
    }

    // Select PAO
    function selectPAO(pao, button) {
      selectedPAO = pao;
      
      // Remove active class from all buttons
      document.querySelectorAll('.pao-option').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Add active class to selected button
      button.classList.add('active');
    }

    // Add product to shelf
    function addProduct() {
      if (!uploadedImage) {
        showError('Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      if (!selectedPAO) {
        showError('PAOÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      const productName = productNameInput.value.trim() || 'Unnamed Product';
      const openedDate = openedDateInput.value;

      if (!openedDate) {
        showError('Í∞úÎ¥âÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
        return;
      }

      // Calculate expiry date
      const opened = new Date(openedDate);
      const expiry = new Date(opened);
      expiry.setMonth(expiry.getMonth() + selectedPAO);

      // Calculate days remaining
      const today = new Date();
      const daysRemaining = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));

      // Determine safety status
      let safetyStatus = 'safe';
      if (daysRemaining < 0) {
        safetyStatus = 'expired';
      } else if (daysRemaining <= 30) {
        safetyStatus = 'warning';
      }

      // Convert image to base64 for storage
      const reader = new FileReader();
      reader.onload = (e) => {
        const product = {
          id: Date.now(),
          name: productName,
          image: e.target.result,
          openedDate: openedDate,
          pao: selectedPAO,
          expiryDate: expiry.toISOString().split('T')[0],
          daysRemaining: daysRemaining,
          safetyStatus: safetyStatus
        };

        products.push(product);
        saveProducts();
        renderShelf();
        clearForm();
        showInfo('‚úÖ Ï†úÌíàÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!');
      };
      reader.readAsDataURL(uploadedImage);
    }

    // Clear form
    function clearForm() {
      imageInput.value = '';
      imagePreview.innerHTML = '<span>Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞</span>';
      productNameInput.value = '';
      setDefaultDate();
      paoButtonsContainer.innerHTML = '';
      selectedPAO = null;
      uploadedImage = null;
      hideMessages();
    }

    // Render shelf
    function renderShelf() {
      if (products.length === 0) {
        shelfContainer.innerHTML = '<p class="empty-shelf">No products yet. Add your first item!</p>';
        return;
      }

      // Sort products by safety status and days remaining
      const sortedProducts = [...products].sort((a, b) => {
        const statusOrder = { expired: 0, warning: 1, safe: 2 };
        if (statusOrder[a.safetyStatus] !== statusOrder[b.safetyStatus]) {
          return statusOrder[a.safetyStatus] - statusOrder[b.safetyStatus];
        }
        return a.daysRemaining - b.daysRemaining;
      });

      // Group by safety status
      const expired = sortedProducts.filter(p => p.safetyStatus === 'expired');
      const warning = sortedProducts.filter(p => p.safetyStatus === 'warning');
      const safe = sortedProducts.filter(p => p.safetyStatus === 'safe');

      shelfContainer.innerHTML = '';

      // Render expired products
      if (expired.length > 0) {
        const section = createShelfSection('üö® TOSS', 'expired', expired);
        shelfContainer.appendChild(section);
      }

      // Render warning products
      if (warning.length > 0) {
        const section = createShelfSection('‚ö†Ô∏è USE SOON', 'warning', warning);
        shelfContainer.appendChild(section);
      }

      // Render safe products
      if (safe.length > 0) {
        const section = createShelfSection('‚úÖ SAFE TO USE', 'safe', safe);
        shelfContainer.appendChild(section);
      }
    }

    // Create shelf section
    function createShelfSection(title, status, products) {
      const section = document.createElement('div');
      section.classList.add('shelf-section', status);
      
      const header = document.createElement('h3');
      header.textContent = title;
      section.appendChild(header);

      const grid = document.createElement('div');
      grid.classList.add('product-grid');

      products.forEach(product => {
        const card = createProductCard(product);
        grid.appendChild(card);
      });

      section.appendChild(grid);
      return section;
    }

    // Create product card
    function createProductCard(product) {
      const card = document.createElement('div');
      card.classList.add('product-card', product.safetyStatus);

      const statusText = product.daysRemaining < 0 
        ? `Í∏∞Ìïú ÎßåÎ£å (${Math.abs(product.daysRemaining)}Ïùº ÏßÄÎÇ®)`
        : `D-${product.daysRemaining}`;

      card.innerHTML = `
        <img src="${product.image}" alt="${product.name}">
        <div class="product-info">
          <h4>${product.name}</h4>
          <p>Í∞úÎ¥âÏùº: ${product.openedDate}</p>
          <p>PAO: ${product.pao}M</p>
          <p class="status-badge ${product.safetyStatus}">${statusText}</p>
        </div>
        <button class="delete-btn" onclick="deleteProduct(${product.id})">Delete</button>
      `;

      return card;
    }

    // Delete product
    function deleteProduct(id) {
      if (confirm('Ï†ïÎßê Ïù¥ Ï†úÌíàÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        products = products.filter(p => p.id !== id);
        saveProducts();
        renderShelf();
        showInfo('Ï†úÌíàÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
      }
    }

    // Clear shelf
    function clearShelf() {
      if (products.length === 0) {
        showInfo('ÏÑ†Î∞òÏù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.');
        return;
      }

      if (confirm('Î™®Îì† Ï†úÌíàÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        products = [];
        saveProducts();
        renderShelf();
        showInfo('Î™®Îì† Ï†úÌíàÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
      }
    }

    // Reset all
    function resetAll() {
      if (confirm('‚ö†Ô∏è Î™®Îì† Îç∞Ïù¥ÌÑ∞Î•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
        products = [];
        saveProducts();
        renderShelf();
        clearForm();
        showInfo('Î™®Îì† Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
      }
    }

    // Local storage functions
    function saveProducts() {
      localStorage.setItem('keepOrTossProducts', JSON.stringify(products));
    }

    function loadProducts() {
      const stored = localStorage.getItem('keepOrTossProducts');
      if (stored) {
        products = JSON.parse(stored);
      }
    }

    // UI feedback functions
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      infoMessage.style.display = 'none';
      setTimeout(() => {
        errorMessage.style.display = 'none';
      }, 5000);
    }

    function showInfo(message) {
      infoMessage.textContent = message;
      infoMessage.style.display = 'block';
      errorMessage.style.display = 'none';
      setTimeout(() => {
        infoMessage.style.display = 'none';
      }, 5000);
    }

    function hideMessages() {
      errorMessage.style.display = 'none';
      infoMessage.style.display = 'none';
    }

    function showLoading(show) {
      loadingIndicator.style.display = show ? 'flex' : 'none';
    }
  </script>
</body>
</html>