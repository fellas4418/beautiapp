<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Keep or Toss</title>

<style>
:root{
  --bg:#0b0c10;
  --card:#111318;
  --text:#e8e8ea;
  --muted:#a8abb4;
  --border:rgba(255,255,255,.10);
  --ok:#20c997;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:720px;margin:0 auto;padding:16px;}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:16px;
}
button{
  background:#1f2430;
  border:1px solid var(--border);
  color:var(--text);
  padding:12px 14px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
}
.paoGrid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-top:12px;
}
.paoBtn.active{
  border-color:var(--ok);
  box-shadow:0 0 0 2px rgba(32,201,151,.3) inset;
}
.preview{
  margin-top:12px;
  border:1px solid var(--border);
  border-radius:12px;
  overflow:hidden;
}
.preview img{width:100%;display:block;}
</style>
</head>

<body>
<div class="wrap">
  <h1>Keep or Toss</h1>
  <div class="card">

    <input type="file" id="fileInput" accept="image/*">
    <div class="preview" id="preview" style="display:none"></div>

    <div class="paoGrid" id="paoGrid"></div>

    <div style="margin-top:12px;display:flex;gap:10px">
      <button id="analyzeBtn">Analyze</button>
    </div>

  </div>
</div>

<script>
/* ===== STATE ===== */
const PAO = [3,6,9,12,18,24,36];
let selectedPao = null;
let currentImageBase64 = null;

/* ===== PAO BUTTONS ===== */
const grid = document.getElementById("paoGrid");
PAO.forEach(m=>{
  const b=document.createElement("button");
  b.textContent=m+"M";
  b.className="paoBtn";
  b.onclick=()=>selectPAO(m);
  grid.appendChild(b);
});

function selectPAO(m){
  selectedPao=m;
  [...grid.children].forEach(x=>x.classList.remove("active"));
  [...grid.children].find(b=>b.textContent===m+"M")?.classList.add("active");
  console.log("PAO selected:", m);
}

/* ===== IMAGE → BASE64 ===== */
document.getElementById("fileInput").onchange = e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = () => {
    currentImageBase64 = reader.result.split(",")[1];
    console.log("base64 length:", currentImageBase64.length);

    const img = document.createElement("img");
    img.src = reader.result;
    const p = document.getElementById("preview");
    p.innerHTML = "";
    p.appendChild(img);
    p.style.display="block";
  };
  reader.readAsDataURL(file);
};

/* ===== OCR FETCH ===== */
document.getElementById("analyzeBtn").onclick = async () => {
  if (!currentImageBase64) {
    alert("이미지 먼저 선택");
    return;
  }

  const res = await fetch("https://pao-ocr-worker.ohryee.workers.dev/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ imageBase64: currentImageBase64 })
  });

  const json = await res.json();
  console.log("OCR RESULT:", json);

  if (json.pao) {
    selectPAO(json.pao);
  } else {
    alert("PAO 인식 실패");
  }
};
</script>
</body>
</html>
