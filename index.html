<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Keep or Toss</title>

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0b0c10;
      color: #eaeaf0;
      display: flex;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: 360px;
      background: #111318;
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,.6);
    }

    h1 {
      margin: 0 0 12px;
      font-size: 18px;
    }

    input, button {
      width: 100%;
      margin-bottom: 8px;
      padding: 10px;
      border-radius: 10px;
      border: none;
      background: #1a1d24;
      color: #fff;
      font-size: 14px;
    }

    .preview {
      width: 100%;
      height: 220px;
      border-radius: 12px;
      background: #0f1116;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .pao-buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
      margin-bottom: 12px;
    }

    .pao-buttons button {
      background: #1f2430;
      font-size: 12px;
    }

    .pao-buttons button.active {
      background: #2b6cff;
    }

    .result {
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      background: #0f1116;
      text-align: center;
      font-size: 13px;
    }

    .SAFE { color: #20c997; }
    .USE\ SOON { color: #ffcc00; }
    .TOSS { color: #ff4d4f; }
  </style>
</head>

<body>
  <div class="app">
    <h1>Keep or Toss</h1>

    <input type="file" accept="image/*" id="imageInput" />

    <div class="preview" id="preview">
      <span>사진 선택</span>
    </div>

    <input type="date" id="openedDate" />

    <div class="pao-buttons" id="paoButtons"></div>

    <div class="result" id="result">PAO와 날짜를 선택하세요</div>
  </div>

  <script>
    // ===== 상태 =====
    let selectedPao = null;

    // ===== PAO 버튼 생성 =====
    const paoList = [3, 6, 9, 12, 18, 24, 36];
    const paoWrap = document.getElementById("paoButtons");

    paoList.forEach(m => {
      const btn = document.createElement("button");
      btn.textContent = m + "M";
      btn.onclick = () => {
        document.querySelectorAll(".pao-buttons button")
          .forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        selectedPao = m;
        recalc();
      };
      paoWrap.appendChild(btn);
    });

    // ===== 이미지 미리보기 =====
    document.getElementById("imageInput").onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const img = document.createElement("img");
      img.src = URL.createObjectURL(file);
      const preview = document.getElementById("preview");
      preview.innerHTML = "";
      preview.appendChild(img);
    };

    document.getElementById("openedDate").onchange = recalc;

    // ===== 계산 함수 =====
    function calculateItem(openedAt, paoMonths) {
      if (!openedAt || !paoMonths) return null;

      const openDate = new Date(openedAt);
      const tossDate = new Date(openDate);
      tossDate.setMonth(tossDate.getMonth() + paoMonths);

      const today = new Date();
      today.setHours(0,0,0,0);
      tossDate.setHours(0,0,0,0);

      const daysLeft = Math.floor(
        (tossDate - today) / (1000 * 60 * 60 * 24)
      );

      let status = "SAFE";
      if (daysLeft < 0) status = "TOSS";
      else if (daysLeft <= 30) status = "USE SOON";

      return {
        openedAt,
        paoMonths,
        tossAt: tossDate.toISOString().slice(0,10),
        daysLeft,
        status
      };
    }

    // ===== 재계산 =====
    function recalc() {
      const openedAt = document.getElementById("openedDate").value;
      const res = calculateItem(openedAt, selectedPao);
      const box = document.getElementById("result");

      if (!res) {
        box.textContent = "PAO와 날짜를 선택하세요";
        box.className = "result";
        return;
      }

      box.className = "result " + res.status;
      box.innerHTML = `
        <div>${res.status}</div>
        <div>PAO ${res.paoMonths}M</div>
        <div>Toss at ${res.tossAt}</div>
        <div>${res.daysLeft} days left</div>
      `;

      console.log(res);
    }
  </script>
</body>
</html>
